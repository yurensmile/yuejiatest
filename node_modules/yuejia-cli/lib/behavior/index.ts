// import * as ts from 'typescript';
import * as fs from 'fs';
import * as path from 'path';
// import writeLog from './writeLog';
// import createSourceFile from './createSourceFile';
import getPageData from './getPageData';
// import getAppRoutes from './getAppRoutes';
// import getFileNameByRoute from './getFileNameByRoute';
import createXlsx, { Data } from './createXlsx';
import './getSheetConfig';

interface PageDataMap {
  [filename: string]: Data[];
}

/** 获取目标页面标题名称 */
// function getTargetPageName(routes: Routes, routePath: string, pageDataMap: PageDataMap, pageDataMapKeys: string[]): string {
//   const targetFileName = getFileNameByRoute(routes, routePath);
//   let targetPageName = '';

//   for (let i = 0; i < pageDataMapKeys.length; i++) {
//     if (targetFileName === pageDataMapKeys[i]) {
//       targetPageName = pageDataMap[pageDataMapKeys[i]].pageName;
//       break;
//     }
//   }

//   return targetPageName;
// }

export default function outputBehavior(): void {
  const baseDir = './src/app/view/pages';
  // const appRoutePath = './src/app/launcher.tsx';
  // const appRouteSource = createSourceFile(appRoutePath);
  // const appRoutes = getAppRoutes(appRouteSource);
  // const behavior: Map<string, Data[]> = new Map();
  const pageDataMap: PageDataMap = {};
  const data: Data[] = [];

  // 收集每个页面的行为信息
  fs.readdirSync(baseDir).forEach((filename, i) => {
    const pagePath = path.join(baseDir, filename, './index.tsx');
    const pageData = getPageData(pagePath);

    pageDataMap[filename] = pageData;
    // const sourceFile = createSourceFile(pagePath);
    // writeLog(filename, sourceFile);
  });

  const pageDataMapKeys = Object.keys(pageDataMap);

  // 处理收集到的数据
  pageDataMapKeys.forEach((key) => {
    const pageData = pageDataMap[key];

    pageData.forEach((item) => {
      data.push(item);
    });
  });
  // console.log(data);
  createXlsx(data);
}